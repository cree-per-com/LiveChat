<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<body>
<h2>Login</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>

<h2>Fetch Protected Resource</h2>
<button onclick="fetchProtectedResource('http://localhost:8080/menu')">Fetch Resource</button>

<script>
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const loginUrl = 'http://localhost:8080/loginProc';

        fetch(loginUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
        })
            .then(response => {
                // 응답에서 JWT 토큰 추출
                const authToken = response.headers.get('Authorization');
                if (authToken) {
                    // 추출된 토큰을 로컬 스토리지에 저장
                    localStorage.setItem('authToken', authToken);
                    alert('Login successful');
                } else {
                    alert('Login failed: No token received');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
            });
    }

    function fetchProtectedResource(url) {
        const authToken = localStorage.getItem('authToken');
        if (!authToken) {
            alert('No auth token found. Please login first.');
            return;
        }

        fetch(url, {
            method: 'GET',
            headers: {
                'Authorization': authToken
            }
        })
            .then(response => {
                if (response.ok) {
                    return response.json(); // JSON 파싱
                } else {
                    throw new Error('Failed to fetch protected resource');
                }
            })
            .then(data => {
                console.log('Protected resource data:', data);
                alert('Check the console for protected resource data');
            })
            .catch(error => {
                console.error('Error fetching protected resource:', error);
            });
    }
</script>
</body>
</html>